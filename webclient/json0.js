(function(){var e={exports:{}},n=e.exports;n._bootstrapTransform=function(e,n,i,t){var r,o;return r=function(e,i,t,r){return n(t,e,i,"left"),n(r,i,e,"right")},e.transformX=e.transformX=o=function(e,n){var l,p,d,f,s,u,a,c,h,v,g,m,w,y,O,b,k,E,x;for(i(e),i(n),s=[],v=0,y=n.length;y>v;v++){for(h=n[v],f=[],l=0;e.length>l;){if(u=[],r(e[l],h,f,u),l++,1!==u.length){if(0===u.length){for(E=e.slice(l),g=0,O=E.length;O>g;g++)p=E[g],t(f,p);h=null;break}for(x=o(e.slice(l),u),d=x[0],c=x[1],m=0,b=d.length;b>m;m++)p=d[m],t(f,p);for(w=0,k=c.length;k>w;w++)a=c[w],t(s,a);h=null;break}h=u[0]}null!=h&&t(s,h),e=f}return[e,s]},e.transform=e.transform=function(e,i,t){if("left"!==t&&"right"!==t)throw Error("type must be 'left' or 'right'");return 0===i.length?e:1===e.length&&1===i.length?n([],e[0],i[0],t):"left"===t?o(e,i)[0]:o(i,e)[1]}};var i,t,r,o,l,p,d,f;p={name:"text-old",uri:"http://sharejs.org/types/textv0",create:function(){return""}},l=function(e,n,i){return e.slice(0,n)+i+e.slice(n)},t=function(e){var n,i;if("number"!=typeof e.p)throw Error("component missing position field");if(i=typeof e.i,n=typeof e.d,!("string"===i^"string"===n))throw Error("component needs an i or d field");if(!(e.p>=0))throw Error("position cannot be negative")},r=function(e){var n,i,r;for(i=0,r=e.length;r>i;i++)n=e[i],t(n);return!0},p.apply=function(e,n){var i,t,o,p;for(r(n),o=0,p=n.length;p>o;o++)if(i=n[o],null!=i.i)e=l(e,i.p,i.i);else{if(t=e.slice(i.p,i.p+i.d.length),i.d!==t)throw Error("Delete component '"+i.d+"' does not match deleted text '"+t+"'");e=e.slice(0,i.p)+e.slice(i.p+i.d.length)}return e},p._append=i=function(e,n){var i,t,r;if(""!==n.i&&""!==n.d)return 0===e.length?e.push(n):(i=e[e.length-1],null!=i.i&&null!=n.i&&i.p<=(t=n.p)&&i.p+i.i.length>=t?e[e.length-1]={i:l(i.i,n.p-i.p,n.i),p:i.p}:null!=i.d&&null!=n.d&&n.p<=(r=i.p)&&n.p+n.d.length>=r?e[e.length-1]={d:l(n.d,i.p-n.p,i.d),p:n.p}:e.push(n))},p.compose=function(e,n){var t,o,l,p;for(r(e),r(n),o=e.slice(),l=0,p=n.length;p>l;l++)t=n[l],i(o,t);return o},p.compress=function(e){return p.compose([],e)},p.normalize=function(e){var n,t,r,o,l;for(t=[],(null!=e.i||null!=e.p)&&(e=[e]),r=0,o=e.length;o>r;r++)n=e[r],null==(l=n.p)&&(n.p=0),i(t,n);return t},f=function(e,n,i){return null!=n.i?e>n.p||n.p===e&&i?e+n.i.length:e:n.p>=e?e:n.p+n.d.length>=e?n.p:e-n.d.length},p.transformCursor=function(e,n,i){var t,r,o,l;for(r="right"===i,o=0,l=n.length;l>o;o++)t=n[o],e=f(e,t,r);return e},p._tc=d=function(e,n,t,o){var l,p,d,s,u,a;if(r([n]),r([t]),null!=n.i)i(e,{i:n.i,p:f(n.p,t,"right"===o)});else if(null!=t.i)a=n.d,n.p<t.p&&(i(e,{d:a.slice(0,t.p-n.p),p:n.p}),a=a.slice(t.p-n.p)),""!==a&&i(e,{d:a,p:n.p+t.i.length});else if(n.p>=t.p+t.d.length)i(e,{d:n.d,p:n.p-t.d.length});else if(n.p+n.d.length<=t.p)i(e,n);else{if(s={d:"",p:n.p},n.p<t.p&&(s.d=n.d.slice(0,t.p-n.p)),n.p+n.d.length>t.p+t.d.length&&(s.d+=n.d.slice(t.p+t.d.length-n.p)),d=Math.max(n.p,t.p),p=Math.min(n.p+n.d.length,t.p+t.d.length),l=n.d.slice(d-n.p,p-n.p),u=t.d.slice(d-t.p,p-t.p),l!==u)throw Error("Delete ops delete different text in the same region of the document");""!==s.d&&(s.p=f(s.p,t),i(e,s))}return e},o=function(e){return null!=e.i?{d:e.i,p:e.p}:{i:e.d,p:e.p}},p.invert=function(e){var n,i,t,r,l;for(r=e.slice().reverse(),l=[],i=0,t=r.length;t>i;i++)n=r[i],l.push(o(n));return l},"undefined"!=typeof window&&null!==window?n._bootstrapTransform(p,p.transformComponent,p.checkValidOp,p.append):require("./helpers")._bootstrapTransform(p,p.transformComponent,p.checkValidOp,p.append),e.exports=p;var s,u,a,p;p="undefined"!=typeof window&&null!==window?e.exports:require("./text-old"),a={name:"json0",uri:"http://sharejs.org/types/JSONv0"},a.create=function(){return null},a.invertComponent=function(e){var n;return n={p:e.p},void 0!==e.si&&(n.sd=e.si),void 0!==e.sd&&(n.si=e.sd),void 0!==e.oi&&(n.od=e.oi),void 0!==e.od&&(n.oi=e.od),void 0!==e.li&&(n.ld=e.li),void 0!==e.ld&&(n.li=e.ld),void 0!==e.na&&(n.na=-e.na),void 0!==e.lm&&(n.lm=e.p[e.p.length-1],n.p=e.p.slice(0,e.p.length-1).concat([e.lm])),n},a.invert=function(e){var n,i,t,r,o;for(r=e.slice().reverse(),o=[],i=0,t=r.length;t>i;i++)n=r[i],o.push(a.invertComponent(n));return o},u=function(e){return"[object Array]"===Object.prototype.toString.call(e)},a.checkValidOp=function(e){var n,i,t,r;for(r=[],i=0,t=e.length;t>i;i++){if(n=e[i],!u(n.p))throw Error("Missing path");r.push(void 0)}return r},a.checkList=function(e){if(!u(e))throw Error("Referenced element not a list")},a.checkObj=function(e){if(e.constructor!==Object)throw Error("Referenced element not an object (it was "+JSON.stringify(e)+")")},a.apply=function(e,n){var i,t,r,o,l,p,d,f,u,c,h,v,g,m;for(a.checkValidOp(n),n=s(n),t={data:e},l=c=0,v=n.length;v>c;l=++c){for(i=n[l],f=null,u=null,o=t,p="data",m=i.p,h=0,g=m.length;g>h;h++)if(d=m[h],f=o,u=p,o=o[p],p=d,null==f)throw Error("Path invalid");if(void 0!==i.na){if("number"!=typeof o[p])throw Error("Referenced element not a number");o[p]+=i.na}else if(void 0!==i.si){if("string"!=typeof o)throw Error("Referenced element not a string (it was "+JSON.stringify(o)+")");f[u]=o.slice(0,p)+i.si+o.slice(p)}else if(void 0!==i.sd){if("string"!=typeof o)throw Error("Referenced element not a string");if(o.slice(p,p+i.sd.length)!==i.sd)throw Error("Deleted string does not match");f[u]=o.slice(0,p)+o.slice(p+i.sd.length)}else if(void 0!==i.li&&void 0!==i.ld)a.checkList(o),o[p]=i.li;else if(void 0!==i.li)a.checkList(o),o.splice(p,0,i.li);else if(void 0!==i.ld)a.checkList(o),o.splice(p,1);else if(void 0!==i.lm)a.checkList(o),i.lm!==p&&(r=o[p],o.splice(p,1),o.splice(i.lm,0,r));else if(void 0!==i.oi)a.checkObj(o),o[p]=i.oi;else{if(void 0===i.od)throw Error("invalid / missing instruction in op");a.checkObj(o),delete o[p]}}return t.data},a.incrementalApply=function(e,n,i){var t,r,o,l;for(o=0,l=n.length;l>o;o++)t=n[o],r=[t],e=a.apply(e,r),i(r,e);return e},a.pathMatches=function(e,n,i){var t,r,o,l;if(e.length!==n.length)return!1;for(t=o=0,l=e.length;l>o;t=++o)if(r=e[t],r!==n[t]&&(!i||t!==e.length-1))return!1;return!0},a.append=function(e,n){var i;return n=s(n),0!==e.length&&a.pathMatches(n.p,(i=e[e.length-1]).p)?void 0!==i.na&&void 0!==n.na?e[e.length-1]={p:i.p,na:i.na+n.na}:void 0!==i.li&&void 0===n.li&&n.ld===i.li?void 0!==i.ld?delete i.li:e.pop():void 0!==i.od&&void 0===i.oi&&void 0!==n.oi&&void 0===n.od?i.oi=n.oi:void 0!==n.lm&&n.p[n.p.length-1]===n.lm?null:e.push(n):e.push(n)},a.compose=function(e,n){var i,t,r,o;for(a.checkValidOp(e),a.checkValidOp(n),t=s(e),r=0,o=n.length;o>r;r++)i=n[r],a.append(t,i);return t},a.normalize=function(e){var n,i,t,r,o;for(i=[],u(e)||(e=[e]),t=0,r=e.length;r>t;t++)n=e[t],null==(o=n.p)&&(n.p=[]),a.append(i,n);return i},s=function(e){return JSON.parse(JSON.stringify(e))},a.canOpAffectOp=function(e,n){var i,t,r,o;if(0===e.length)return!0;if(0===n.length)return!1;for(n=n.slice(0,n.length-1),e=e.slice(0,e.length-1),i=r=0,o=e.length;o>r;i=++r){if(t=e[i],i>=n.length)return!1;if(t!==n[i])return!1}return!0},a.transformComponent=function(e,n,i,t){var r,o,l,d,f,u,c,h,v,g,m,w,y,O,b,k,E,x,j;if(n=s(n),void 0!==n.na&&n.p.push(0),void 0!==i.na&&i.p.push(0),a.canOpAffectOp(i.p,n.p)&&(r=i.p.length-1),a.canOpAffectOp(n.p,i.p)&&(o=n.p.length-1),f=n.p.length,v=i.p.length,void 0!==n.na&&n.p.pop(),void 0!==i.na&&i.p.pop(),i.na)return null!=o&&v>=f&&i.p[o]===n.p[o]&&(void 0!==n.ld?(h=s(i),h.p=h.p.slice(f),n.ld=a.apply(s(n.ld),[h])):void 0!==n.od&&(h=s(i),h.p=h.p.slice(f),n.od=a.apply(s(n.od),[h]))),a.append(e,n),e;if(null!=o&&v>f&&n.p[o]===i.p[o]&&(void 0!==n.ld?(h=s(i),h.p=h.p.slice(f),n.ld=a.apply(s(n.ld),[h])):void 0!==n.od&&(h=s(i),h.p=h.p.slice(f),n.od=a.apply(s(n.od),[h]))),null!=r)if(l=f===v,void 0!==i.na);else if(void 0!==i.si||void 0!==i.sd){if(void 0!==n.si||void 0!==n.sd){if(!l)throw Error("must be a string?");for(d=function(e){var n;return n={p:e.p[e.p.length-1]},null!=e.si?n.i=e.si:n.d=e.sd,n},b=d(n),k=d(i),y=[],p._tc(y,b,k,t),x=0,j=y.length;j>x;x++)O=y[x],c={p:n.p.slice(0,r)},c.p.push(O.p),null!=O.i&&(c.si=O.i),null!=O.d&&(c.sd=O.d),a.append(e,c);return e}}else if(void 0!==i.li&&void 0!==i.ld){if(i.p[r]===n.p[r]){if(!l)return e;if(void 0!==n.ld){if(void 0===n.li||"left"!==t)return e;n.ld=s(i.li)}}}else if(void 0!==i.li)void 0!==n.li&&void 0===n.ld&&l&&n.p[r]===i.p[r]?"right"===t&&n.p[r]++:i.p[r]<=n.p[r]&&n.p[r]++,void 0!==n.lm&&l&&i.p[r]<=n.lm&&n.lm++;else if(void 0!==i.ld){if(void 0!==n.lm&&l){if(i.p[r]===n.p[r])return e;w=i.p[r],u=n.p[r],E=n.lm,(E>w||w===E&&E>u)&&n.lm--}if(i.p[r]<n.p[r])n.p[r]--;else if(i.p[r]===n.p[r]){if(f>v)return e;if(void 0!==n.ld){if(void 0===n.li)return e;delete n.ld}}}else if(void 0!==i.lm)if(void 0!==n.lm&&f===v){if(u=n.p[r],E=n.lm,g=i.p[r],m=i.lm,g!==m)if(u===g){if("left"!==t)return e;n.p[r]=m,u===E&&(n.lm=m)}else u>g&&n.p[r]--,u>m?n.p[r]++:u===m&&g>m&&(n.p[r]++,u===E&&n.lm++),E>g?n.lm--:E===g&&E>u&&n.lm--,E>m?n.lm++:E===m&&(m>g&&E>u||g>m&&u>E?"right"===t&&n.lm++:E>u?n.lm++:E===g&&n.lm--)}else void 0!==n.li&&void 0===n.ld&&l?(u=i.p[r],E=i.lm,w=n.p[r],w>u&&n.p[r]--,w>E&&n.p[r]++):(u=i.p[r],E=i.lm,w=n.p[r],w===u?n.p[r]=E:(w>u&&n.p[r]--,w>E?n.p[r]++:w===E&&u>E&&n.p[r]++));else if(void 0!==i.oi&&void 0!==i.od){if(n.p[r]===i.p[r]){if(void 0===n.oi||!l)return e;if("right"===t)return e;n.od=i.oi}}else if(void 0!==i.oi){if(void 0!==n.oi&&n.p[r]===i.p[r]){if("left"!==t)return e;a.append(e,{p:n.p,od:i.oi})}}else if(void 0!==i.od&&n.p[r]===i.p[r]){if(!l)return e;if(void 0===n.oi)return e;delete n.od}return a.append(e,n),e},"undefined"!=typeof window&&null!==window?n._bootstrapTransform(a,a.transformComponent,a.checkValidOp,a.append):require("./helpers")._bootstrapTransform(a,a.transformComponent,a.checkValidOp,a.append),e.exports=a;var c=window.ottypes=window.ottypes||{},h=e.exports;c[h.name]=h,h.uri&&(c[h.uri]=h)})();