(function(){var e={exports:{}},i=e.exports;i._bootstrapTransform=function(e,i,n,t){var o,r;return o=function(e,n,t,o){return i(t,e,n,"left"),i(o,n,e,"right")},e.transformX=e.transformX=r=function(e,i){var l,p,d,f,s,a,c,u,h,v,m,g,w,O,y,b,k,E,j;for(n(e),n(i),s=[],v=0,O=i.length;O>v;v++){for(h=i[v],f=[],l=0;e.length>l;){if(a=[],o(e[l],h,f,a),l++,1!==a.length){if(0===a.length){for(E=e.slice(l),m=0,y=E.length;y>m;m++)p=E[m],t(f,p);h=null;break}for(j=r(e.slice(l),a),d=j[0],u=j[1],g=0,b=d.length;b>g;g++)p=d[g],t(f,p);for(w=0,k=u.length;k>w;w++)c=u[w],t(s,c);h=null;break}h=a[0]}null!=h&&t(s,h),e=f}return[e,s]},e.transform=e.transform=function(e,n,t){if("left"!==t&&"right"!==t)throw Error("type must be 'left' or 'right'");return 0===n.length?e:1===e.length&&1===n.length?i([],e[0],n[0],t):"left"===t?r(e,n)[0]:r(n,e)[1]}};var n,t,o,r;r="undefined"!=typeof window&&null!==window?window.ottypes.text:require("./text-old"),o={},o.name="json0",o.uri="http://sharejs.org/types/JSONv0",o.create=function(){return null},o.invertComponent=function(e){var i;return i={p:e.p},void 0!==e.si&&(i.sd=e.si),void 0!==e.sd&&(i.si=e.sd),void 0!==e.oi&&(i.od=e.oi),void 0!==e.od&&(i.oi=e.od),void 0!==e.li&&(i.ld=e.li),void 0!==e.ld&&(i.li=e.ld),void 0!==e.na&&(i.na=-e.na),void 0!==e.lm&&(i.lm=e.p[e.p.length-1],i.p=e.p.slice(0,e.p.length-1).concat([e.lm])),i},o.invert=function(e){var i,n,t,r,l;for(r=e.slice().reverse(),l=[],n=0,t=r.length;t>n;n++)i=r[n],l.push(o.invertComponent(i));return l},o.checkValidOp=function(){},t=function(e){return"[object Array]"===Object.prototype.toString.call(e)},o.checkList=function(e){if(!t(e))throw Error("Referenced element not a list")},o.checkObj=function(e){if(e.constructor!==Object)throw Error("Referenced element not an object (it was "+JSON.stringify(e)+")")},o.apply=function(e,i){var t,r,l,p,d,f,s,a,c,u,h,v,m,g,w;o.checkValidOp(i),i=n(i),r={data:e};try{for(f=h=0,m=i.length;m>h;f=++h){for(t=i[f],c=null,u=null,p=r,s="data",w=t.p,v=0,g=w.length;g>v;v++)if(a=w[v],c=p,u=s,p=p[s],s=a,null==c)throw Error("Path invalid");if(void 0!==t.na){if("number"!=typeof p[s])throw Error("Referenced element not a number");p[s]+=t.na}else if(void 0!==t.si){if("string"!=typeof p)throw Error("Referenced element not a string (it was "+JSON.stringify(p)+")");c[u]=p.slice(0,s)+t.si+p.slice(s)}else if(void 0!==t.sd){if("string"!=typeof p)throw Error("Referenced element not a string");if(p.slice(s,s+t.sd.length)!==t.sd)throw Error("Deleted string does not match");c[u]=p.slice(0,s)+p.slice(s+t.sd.length)}else if(void 0!==t.li&&void 0!==t.ld)o.checkList(p),p[s]=t.li;else if(void 0!==t.li)o.checkList(p),p.splice(s,0,t.li);else if(void 0!==t.ld)o.checkList(p),p.splice(s,1);else if(void 0!==t.lm)o.checkList(p),t.lm!==s&&(l=p[s],p.splice(s,1),p.splice(t.lm,0,l));else if(void 0!==t.oi)o.checkObj(p),p[s]=t.oi;else{if(void 0===t.od)throw Error("invalid / missing instruction in op");o.checkObj(p),delete p[s]}}}catch(O){throw d=O}return r.data},o.pathMatches=function(e,i,n){var t,o,r,l;if(e.length!==i.length)return!1;for(t=r=0,l=e.length;l>r;t=++r)if(o=e[t],o!==i[t]&&(!n||t!==e.length-1))return!1;return!0},o.append=function(e,i){var t;return i=n(i),0!==e.length&&o.pathMatches(i.p,(t=e[e.length-1]).p)?void 0!==t.na&&void 0!==i.na?e[e.length-1]={p:t.p,na:t.na+i.na}:void 0!==t.li&&void 0===i.li&&i.ld===t.li?void 0!==t.ld?delete t.li:e.pop():void 0!==t.od&&void 0===t.oi&&void 0!==i.oi&&void 0===i.od?t.oi=i.oi:void 0!==i.lm&&i.p[i.p.length-1]===i.lm?null:e.push(i):e.push(i)},o.compose=function(e,i){var t,r,l,p;for(o.checkValidOp(e),o.checkValidOp(i),r=n(e),l=0,p=i.length;p>l;l++)t=i[l],o.append(r,t);return r},o.normalize=function(e){var i,n,r,l,p;for(n=[],t(e)||(e=[e]),r=0,l=e.length;l>r;r++)i=e[r],null==(p=i.p)&&(i.p=[]),o.append(n,i);return n},n=function(e){return JSON.parse(JSON.stringify(e))},o.canOpAffectOp=function(e,i){var n,t,o,r;if(0===e.length)return!0;if(0===i.length)return!1;for(i=i.slice(0,i.length-1),e=e.slice(0,e.length-1),n=o=0,r=e.length;r>o;n=++o){if(t=e[n],n>=i.length)return!1;if(t!==i[n])return!1}return!0},o.transformComponent=function(e,i,t,l){var p,d,f,s,a,c,u,h,v,m,g,w,O,y,b,k,E,j,x;if(i=n(i),void 0!==i.na&&i.p.push(0),void 0!==t.na&&t.p.push(0),o.canOpAffectOp(t.p,i.p)&&(p=t.p.length-1),o.canOpAffectOp(i.p,t.p)&&(d=i.p.length-1),a=i.p.length,v=t.p.length,void 0!==i.na&&i.p.pop(),void 0!==t.na&&t.p.pop(),t.na)return null!=d&&v>=a&&t.p[d]===i.p[d]&&(void 0!==i.ld?(h=n(t),h.p=h.p.slice(a),i.ld=o.apply(n(i.ld),[h])):void 0!==i.od&&(h=n(t),h.p=h.p.slice(a),i.od=o.apply(n(i.od),[h]))),o.append(e,i),e;if(null!=d&&v>a&&i.p[d]===t.p[d]&&(void 0!==i.ld?(h=n(t),h.p=h.p.slice(a),i.ld=o.apply(n(i.ld),[h])):void 0!==i.od&&(h=n(t),h.p=h.p.slice(a),i.od=o.apply(n(i.od),[h]))),null!=p)if(f=a===v,void 0!==t.na);else if(void 0!==t.si||void 0!==t.sd){if(void 0!==i.si||void 0!==i.sd){if(!f)throw Error("must be a string?");for(s=function(e){var i;return i={p:e.p[e.p.length-1]},null!=e.si?i.i=e.si:i.d=e.sd,i},b=s(i),k=s(t),O=[],r._tc(O,b,k,l),j=0,x=O.length;x>j;j++)y=O[j],u={p:i.p.slice(0,p)},u.p.push(y.p),null!=y.i&&(u.si=y.i),null!=y.d&&(u.sd=y.d),o.append(e,u);return e}}else if(void 0!==t.li&&void 0!==t.ld){if(t.p[p]===i.p[p]){if(!f)return e;if(void 0!==i.ld){if(void 0===i.li||"left"!==l)return e;i.ld=n(t.li)}}}else if(void 0!==t.li)void 0!==i.li&&void 0===i.ld&&f&&i.p[p]===t.p[p]?"right"===l&&i.p[p]++:t.p[p]<=i.p[p]&&i.p[p]++,void 0!==i.lm&&f&&t.p[p]<=i.lm&&i.lm++;else if(void 0!==t.ld){if(void 0!==i.lm&&f){if(t.p[p]===i.p[p])return e;w=t.p[p],c=i.p[p],E=i.lm,(E>w||w===E&&E>c)&&i.lm--}if(t.p[p]<i.p[p])i.p[p]--;else if(t.p[p]===i.p[p]){if(a>v)return e;if(void 0!==i.ld){if(void 0===i.li)return e;delete i.ld}}}else if(void 0!==t.lm)if(void 0!==i.lm&&a===v){if(c=i.p[p],E=i.lm,m=t.p[p],g=t.lm,m!==g)if(c===m){if("left"!==l)return e;i.p[p]=g,c===E&&(i.lm=g)}else c>m&&i.p[p]--,c>g?i.p[p]++:c===g&&m>g&&(i.p[p]++,c===E&&i.lm++),E>m?i.lm--:E===m&&E>c&&i.lm--,E>g?i.lm++:E===g&&(g>m&&E>c||m>g&&c>E?"right"===l&&i.lm++:E>c?i.lm++:E===m&&i.lm--)}else void 0!==i.li&&void 0===i.ld&&f?(c=t.p[p],E=t.lm,w=i.p[p],w>c&&i.p[p]--,w>E&&i.p[p]++):(c=t.p[p],E=t.lm,w=i.p[p],w===c?i.p[p]=E:(w>c&&i.p[p]--,w>E?i.p[p]++:w===E&&c>E&&i.p[p]++));else if(void 0!==t.oi&&void 0!==t.od){if(i.p[p]===t.p[p]){if(void 0===i.oi||!f)return e;if("right"===l)return e;i.od=t.oi}}else if(void 0!==t.oi){if(void 0!==i.oi&&i.p[p]===t.p[p]){if("left"!==l)return e;o.append(e,{p:i.p,od:t.oi})}}else if(void 0!==t.od&&i.p[p]===t.p[p]){if(!f)return e;if(void 0===i.oi)return e;delete i.od}return o.append(e,i),e},"undefined"!=typeof window&&null!==window?i._bootstrapTransform(o,o.transformComponent,o.checkValidOp,o.append):require("./helpers")._bootstrapTransform(o,o.transformComponent,o.checkValidOp,o.append),e.exports=o;var l=window.ottypes=window.ottypes||{},p=e.exports;l[p.name]=p,p.uri&&(l[p.uri]=p)})();