(function(){var e={exports:{}},i=e.exports,n=function(e){return"[object Array]"==Object.prototype.toString.call(e)},r=function(e){return JSON.parse(JSON.stringify(e))},t="undefined"!=typeof require?require("./text-old"):window.ottypes.text,l={name:"json0",uri:"http://sharejs.org/types/JSONv0"};l.create=function(e){return void 0===e?null:e},l.invertComponent=function(e){var i={p:e.p};return void 0!==e.si&&(i.sd=e.si),void 0!==e.sd&&(i.si=e.sd),void 0!==e.oi&&(i.od=e.oi),void 0!==e.od&&(i.oi=e.od),void 0!==e.li&&(i.ld=e.li),void 0!==e.ld&&(i.li=e.ld),void 0!==e.na&&(i.na=-e.na),void 0!==e.lm&&(i.lm=e.p[e.p.length-1],i.p=e.p.slice(0,e.p.length-1).concat([e.lm])),i},l.invert=function(e){for(var i=e.slice().reverse(),n=[],r=0;i.length>r;r++)n.push(l.invertComponent(i[r]));return n},l.checkValidOp=function(e){for(var i=0;e.length>i;i++)if(!n(e[i].p))throw Error("Missing path")},l.checkList=function(e){if(!n(e))throw Error("Referenced element not a list")},l.checkObj=function(e){if(e.constructor!==Object)throw Error("Referenced element not an object (it was "+JSON.stringify(e)+")")},l.apply=function(e,i){l.checkValidOp(i),i=r(i);for(var n={data:e},t=0;i.length>t;t++){for(var o=i[t],p=null,d=null,f=n,s="data",a=0;o.p.length>a;a++){var u=o.p[a];if(p=f,d=s,f=f[s],s=u,null==p)throw Error("Path invalid")}if(void 0!==o.na){if("number"!=typeof f[s])throw Error("Referenced element not a number");f[s]+=o.na}else if(void 0!==o.si){if("string"!=typeof f)throw Error("Referenced element not a string (it was "+JSON.stringify(f)+")");p[d]=f.slice(0,s)+o.si+f.slice(s)}else if(void 0!==o.sd){if("string"!=typeof f)throw Error("Referenced element not a string");if(f.slice(s,s+o.sd.length)!==o.sd)throw Error("Deleted string does not match");p[d]=f.slice(0,s)+f.slice(s+o.sd.length)}else if(void 0!==o.li&&void 0!==o.ld)l.checkList(f),f[s]=o.li;else if(void 0!==o.li)l.checkList(f),f.splice(s,0,o.li);else if(void 0!==o.ld)l.checkList(f),f.splice(s,1);else if(void 0!==o.lm){if(l.checkList(f),o.lm!=s){var c=f[s];f.splice(s,1),f.splice(o.lm,0,c)}}else if(void 0!==o.oi)l.checkObj(f),f[s]=o.oi;else{if(void 0===o.od)throw Error("invalid / missing instruction in op");l.checkObj(f),delete f[s]}}return n.data},l.incrementalApply=function(e,i,n){for(var r=0;i.length>r;r++){var t=[i[r]];e=l.apply(e,t),n(t,e)}return e},l.pathMatches=function(e,i,n){if(e.length!=i.length)return!1;for(var r=0;e.length>r;r++)if(e[r]!==i[r]&&(!n||r!==e.length-1))return!1;return!0};var o=function(e){var i={p:e.p[e.p.length-1]};return null!=e.si?i.i=e.si:i.d=e.sd,i};l.append=function(e,i){i=r(i);var n;if(0!=e.length&&l.pathMatches(i.p,(n=e[e.length-1]).p))null!=n.na&&null!=i.na?e[e.length-1]={p:n.p,na:n.na+i.na}:void 0!==n.li&&void 0===i.li&&i.ld===n.li?void 0!==n.ld?delete n.li:e.pop():void 0!==n.od&&void 0===n.oi&&void 0!==i.oi&&void 0===i.od?n.oi=i.oi:void 0!==i.lm&&i.p[i.p.length-1]===i.lm||e.push(i);else if(0!=e.length&&l.pathMatches(i.p,n.p,!0))if(null==i.si&&null==i.sd||null==n.si&&null==n.sd)e.push(i);else{var p=[o(n)];if(t._append(p,o(i)),1!==p.length)e.push(i);else{var d=p[0];n.p[n.p.length-1]=d.p,null!=d.i?n.si=d.i:n.sd=d.d}}else e.push(i)},l.compose=function(e,i){l.checkValidOp(e),l.checkValidOp(i);for(var n=r(e),t=0;i.length>t;t++)l.append(n,i[t]);return n},l.normalize=function(e){var i=[];e=n(e)?e:[e];for(var r=0;e.length>r;r++){var t=e[r];null==t.p&&(t.p=[]),l.append(i,t)}return i},l.canOpAffectOp=function(e,i){if(0===e.length)return!0;if(0===i.length)return!1;i=i.slice(0,i.length-1),e=e.slice(0,e.length-1);for(var n=0;e.length>n;n++){var r=e[n];if(n>=i.length)return!1;if(r!=i[n])return!1}return!0},l.transformComponent=function(e,i,n,p){i=r(i),void 0!==i.na&&i.p.push(0),void 0!==n.na&&n.p.push(0);var d;l.canOpAffectOp(n.p,i.p)&&(d=n.p.length-1);var f;l.canOpAffectOp(i.p,n.p)&&(f=i.p.length-1);var s=i.p.length,a=n.p.length;if(void 0!==i.na&&i.p.pop(),void 0!==n.na&&n.p.pop(),n.na){if(null!=f&&a>=s&&n.p[f]==i.p[f])if(void 0!==i.ld){var u=r(n);u.p=u.p.slice(s),i.ld=l.apply(r(i.ld),[u])}else if(void 0!==i.od){var u=r(n);u.p=u.p.slice(s),i.od=l.apply(r(i.od),[u])}return l.append(e,i),e}if(null!=f&&a>s&&i.p[f]==n.p[f])if(void 0!==i.ld){var u=r(n);u.p=u.p.slice(s),i.ld=l.apply(r(i.ld),[u])}else if(void 0!==i.od){var u=r(n);u.p=u.p.slice(s),i.od=l.apply(r(i.od),[u])}if(null!=d){var c=s==a;if(void 0!==n.na);else if(void 0!==n.si||void 0!==n.sd){if(void 0!==i.si||void 0!==i.sd){if(!c)throw Error("must be a string?");var h=o(i),v=o(n),g=[];t._tc(g,h,v,p);for(var m=0;g.length>m;m++){var y=g[m],w={p:i.p.slice(0,d)};w.p.push(y.p),null!=y.i&&(w.si=y.i),null!=y.d&&(w.sd=y.d),l.append(e,w)}return e}}else if(void 0!==n.li&&void 0!==n.ld){if(n.p[d]===i.p[d]){if(!c)return e;if(void 0!==i.ld){if(void 0===i.li||"left"!==p)return e;i.ld=r(n.li)}}}else if(void 0!==n.li)void 0!==i.li&&void 0===i.ld&&c&&i.p[d]===n.p[d]?"right"===p&&i.p[d]++:n.p[d]<=i.p[d]&&i.p[d]++,void 0!==i.lm&&c&&n.p[d]<=i.lm&&i.lm++;else if(void 0!==n.ld){if(void 0!==i.lm&&c){if(n.p[d]===i.p[d])return e;var O=n.p[d],b=i.p[d],k=i.lm;(k>O||O===k&&k>b)&&i.lm--}if(n.p[d]<i.p[d])i.p[d]--;else if(n.p[d]===i.p[d]){if(s>a)return e;if(void 0!==i.ld){if(void 0===i.li)return e;delete i.ld}}}else if(void 0!==n.lm)if(void 0!==i.lm&&s===a){var b=i.p[d],k=i.lm,E=n.p[d],x=n.lm;if(E!==x)if(b===E){if("left"!==p)return e;i.p[d]=x,b===k&&(i.lm=x)}else b>E&&i.p[d]--,b>x?i.p[d]++:b===x&&E>x&&(i.p[d]++,b===k&&i.lm++),k>E?i.lm--:k===E&&k>b&&i.lm--,k>x?i.lm++:k===x&&(x>E&&k>b||E>x&&b>k?"right"===p&&i.lm++:k>b?i.lm++:k===E&&i.lm--)}else if(void 0!==i.li&&void 0===i.ld&&c){var b=n.p[d],k=n.lm;O=i.p[d],O>b&&i.p[d]--,O>k&&i.p[d]++}else{var b=n.p[d],k=n.lm;O=i.p[d],O===b?i.p[d]=k:(O>b&&i.p[d]--,O>k?i.p[d]++:O===k&&b>k&&i.p[d]++)}else if(void 0!==n.oi&&void 0!==n.od){if(i.p[d]===n.p[d]){if(void 0===i.oi||!c)return e;if("right"===p)return e;i.od=n.oi}}else if(void 0!==n.oi){if(void 0!==i.oi&&i.p[d]===n.p[d]){if("left"!==p)return e;l.append(e,{p:i.p,od:n.oi})}}else if(void 0!==n.od&&i.p[d]==n.p[d]){if(!c)return e;if(void 0===i.oi)return e;delete i.od}}return l.append(e,i),e},"undefined"!=typeof require?require("./helpers")._bootstrapTransform(l,l.transformComponent,l.checkValidOp,l.append):i._bootstrapTransform(l,l.transformComponent,l.checkValidOp,l.append),e.exports=l;var p,d,f,s,a,t,u,c;t={name:"text-old",uri:"http://sharejs.org/types/textv0",create:function(){return""}},a=function(e,i,n){return e.slice(0,i)+n+e.slice(i)},d=function(e){var i,n;if("number"!=typeof e.p)throw Error("component missing position field");if(n=typeof e.i,i=typeof e.d,!("string"===n^"string"===i))throw Error("component needs an i or d field");if(!(e.p>=0))throw Error("position cannot be negative")},f=function(e){var i,n,r;for(n=0,r=e.length;r>n;n++)i=e[n],d(i);return!0},t.apply=function(e,i){var n,r,t,l;for(f(i),t=0,l=i.length;l>t;t++)if(n=i[t],null!=n.i)e=a(e,n.p,n.i);else{if(r=e.slice(n.p,n.p+n.d.length),n.d!==r)throw Error("Delete component '"+n.d+"' does not match deleted text '"+r+"'");e=e.slice(0,n.p)+e.slice(n.p+n.d.length)}return e},t._append=p=function(e,i){var n,r,t;if(""!==i.i&&""!==i.d)return 0===e.length?e.push(i):(n=e[e.length-1],null!=n.i&&null!=i.i&&n.p<=(r=i.p)&&n.p+n.i.length>=r?e[e.length-1]={i:a(n.i,i.p-n.p,i.i),p:n.p}:null!=n.d&&null!=i.d&&i.p<=(t=n.p)&&i.p+i.d.length>=t?e[e.length-1]={d:a(i.d,n.p-i.p,n.d),p:i.p}:e.push(i))},t.compose=function(e,i){var n,r,t,l;for(f(e),f(i),r=e.slice(),t=0,l=i.length;l>t;t++)n=i[t],p(r,n);return r},t.compress=function(e){return t.compose([],e)},t.normalize=function(e){var i,n,r,t,l;for(n=[],(null!=e.i||null!=e.p)&&(e=[e]),r=0,t=e.length;t>r;r++)i=e[r],null==(l=i.p)&&(i.p=0),p(n,i);return n},c=function(e,i,n){return null!=i.i?e>i.p||i.p===e&&n?e+i.i.length:e:i.p>=e?e:i.p+i.d.length>=e?i.p:e-i.d.length},t.transformCursor=function(e,i,n){var r,t,l,o;for(t="right"===n,l=0,o=i.length;o>l;l++)r=i[l],e=c(e,r,t);return e},t._tc=u=function(e,i,n,r){var t,l,o,d,s,a;if(f([i]),f([n]),null!=i.i)p(e,{i:i.i,p:c(i.p,n,"right"===r)});else if(null!=n.i)a=i.d,i.p<n.p&&(p(e,{d:a.slice(0,n.p-i.p),p:i.p}),a=a.slice(n.p-i.p)),""!==a&&p(e,{d:a,p:i.p+n.i.length});else if(i.p>=n.p+n.d.length)p(e,{d:i.d,p:i.p-n.d.length});else if(i.p+i.d.length<=n.p)p(e,i);else{if(d={d:"",p:i.p},i.p<n.p&&(d.d=i.d.slice(0,n.p-i.p)),i.p+i.d.length>n.p+n.d.length&&(d.d+=i.d.slice(n.p+n.d.length-i.p)),o=Math.max(i.p,n.p),l=Math.min(i.p+i.d.length,n.p+n.d.length),t=i.d.slice(o-i.p,l-i.p),s=n.d.slice(o-n.p,l-n.p),t!==s)throw Error("Delete ops delete different text in the same region of the document");""!==d.d&&(d.p=c(d.p,n),p(e,d))}return e},s=function(e){return null!=e.i?{d:e.i,p:e.p}:{i:e.d,p:e.p}},t.invert=function(e){var i,n,r,t,l;for(t=e.slice().reverse(),l=[],n=0,r=t.length;r>n;n++)i=t[n],l.push(s(i));return l},"undefined"==typeof require?i._bootstrapTransform(t,t.transformComponent,t.checkValidOp,t.append):require("./helpers")._bootstrapTransform(t,t.transformComponent,t.checkValidOp,t.append),e.exports=t,i._bootstrapTransform=function(e,i,n,r){var t,l;return t=function(e,n,r,t){return i(r,e,n,"left"),i(t,n,e,"right")},e.transformX=e.transformX=l=function(e,i){var o,p,d,f,s,a,u,c,h,v,g,m,y,w,O,b,k,E,x;for(n(e),n(i),s=[],v=0,w=i.length;w>v;v++){for(h=i[v],f=[],o=0;e.length>o;){if(a=[],t(e[o],h,f,a),o++,1!==a.length){if(0===a.length){for(E=e.slice(o),g=0,O=E.length;O>g;g++)p=E[g],r(f,p);h=null;break}for(x=l(e.slice(o),a),d=x[0],c=x[1],m=0,b=d.length;b>m;m++)p=d[m],r(f,p);for(y=0,k=c.length;k>y;y++)u=c[y],r(s,u);h=null;break}h=a[0]}null!=h&&r(s,h),e=f}return[e,s]},e.transform=e.transform=function(e,n,r){if("left"!==r&&"right"!==r)throw Error("type must be 'left' or 'right'");return 0===n.length?e:1===e.length&&1===n.length?i([],e[0],n[0],r):"left"===r?l(e,n)[0]:l(n,e)[1]}};var h=window.ottypes=window.ottypes||{},v=e.exports;h[v.name]=v,v.uri&&(h[v.uri]=v)})();