(function(){var e,t,r,o,n,i,f,s,a={exports:{}},h=a.exports;a.exports=s={name:"text-tp2",tp2:!0,create:function(){return{charLength:0,totalLength:0,positionCache:[],data:[]}},serialize:function(e){if(!e.data)throw Error("invalid doc snapshot");return e.data},deserialize:function(e){var t,r,o,n;for(r=s.create(),r.data=e,o=0,n=e.length;n>o;o++)t=e[o],"string"==typeof t?(r.charLength+=t.length,r.totalLength+=t.length):r.totalLength+=t;return r}},r=function(e){var t,r,o,n,i;if(!Array.isArray(e))throw Error("Op must be an array of components");for(r=null,i=[],o=0,n=e.length;n>o;o++){if(t=e[o],"object"==typeof t)if(void 0!==t.i){if(!("string"==typeof t.i&&t.i.length>0||"number"==typeof t.i&&t.i>0))throw Error("Inserts must insert a string or a +ive number")}else{if(void 0===t.d)throw Error("Operation component must define .i or .d");if(!("number"==typeof t.d&&t.d>0))throw Error("Deletes must be a +ive number")}else{if("number"!=typeof t)throw Error("Op components must be objects or numbers");if(!(t>0))throw Error("Skip components must be a positive number");if("number"==typeof r)throw Error("Adjacent skip components should be combined")}i.push(r=t)}return i},s._takeDoc=i=function(e,t,r,o){var n,i,f;if(t.index>=e.data.length)throw Error("Operation goes past the end of the document");return n=e.data[t.index],i="string"==typeof n?void 0!==r?n.slice(t.offset,t.offset+r):n.slice(t.offset):void 0===r||o?n-t.offset:Math.min(r,n-t.offset),f=i.length||i,(n.length||n)-t.offset>f?t.offset+=f:(t.index++,t.offset=0),i},s._appendDoc=t=function(e,t){var r;0!==t&&""!==t&&("string"==typeof t?(e.charLength+=t.length,e.totalLength+=t.length):e.totalLength+=t,r=e.data,0===r.length?r.push(t):typeof r[r.length-1]==typeof t?r[r.length-1]+=t:r.push(t))},s.apply=function(e,o){var n,f,a,h,l,u,d;if(void 0===e.totalLength||void 0===e.charLength||void 0===e.data.length)throw Error("Snapshot is invalid");for(r(o),f=s.create(),h={index:0,offset:0},u=0,d=o.length;d>u;u++)if(n=o[u],"number"==typeof n)for(l=n;l>0;)a=i(e,h,l),t(f,a),l-=a.length||a;else if(void 0!==n.i)t(f,n.i);else if(void 0!==n.d){for(l=n.d;l>0;)a=i(e,h,l),l-=a.length||a;t(f,n.d)}return f},s._append=e=function(e,t){var r;return 0!==t&&""!==t.i&&0!==t.i&&0!==t.d?0===e.length?e.push(t):(r=e[e.length-1],"number"==typeof t&&"number"==typeof r?e[e.length-1]+=t:void 0!==t.i&&null!=r.i&&typeof r.i==typeof t.i?r.i+=t.i:void 0!==t.d&&null!=r.d?r.d+=t.d:e.push(t)):void 0},n=function(e){var t,r,o,n;return t=0,r=0,n=function(o,n){var i,f,s,a;return t===e.length?null:(s=e[t],"number"==typeof(f=s)||"number"==typeof(f=s.i)||void 0!==(f=s.d)?(null==o||o>=f-r||n&&void 0!==s.i?(i=f-r,++t,r=0):(r+=o,i=o),void 0!==s.i?{i:i}:void 0!==s.d?{d:i}:i):(null==o||o>=s.i.length-r||n?(a={i:s.i.slice(r)},++t,r=0):(a={i:s.i.slice(r,r+o)},r+=o),a))},o=function(){return e[t]},[n,o]},o=function(e){return"number"==typeof e?e:"string"==typeof e.i?e.i.length:e.d||e.i},s.normalize=function(t){var r,o,n,i;for(o=[],n=0,i=t.length;i>n;n++)r=t[n],e(o,r);return o},f=function(t,i,f,s){var a,h,l,u,d,p,c,g,m,v;for(r(t),r(i),u=[],m=n(t),p=m[0],d=m[1],c=0,g=i.length;g>c;c++)if(h=i[c],l=o(h),void 0!==h.i)if(f){if("left"===s)for(;void 0!==(null!=(v=d())?v.i:void 0);)e(u,p());e(u,l)}else for(;l>0;){if(a=p(l,!0),null===a)throw Error("The transformed op is invalid");if(void 0!==a.d)throw Error("The transformed op deletes locally inserted characters - it cannot be purged of the insert.");"number"==typeof a?l-=a:e(u,a)}else for(;l>0;){if(a=p(l,!0),null===a)throw Error("The op traverses more elements than the document has");e(u,a),a.i||(l-=o(a))}for(;h=p();){if(void 0===h.i)throw Error("Remaining fragments in the op: "+h);e(u,h)}return u},s.transform=function(e,t,r){if("left"!==r&&"right"!==r)throw Error("side ("+r+") should be 'left' or 'right'");return f(e,t,!0,r)},s.prune=function(e,t){return f(e,t,!1)},s.compose=function(t,i){var f,s,a,h,l,u,d,p,c,g;if(null===t||void 0===t)return i;for(r(t),r(i),l=[],g=n(t),u=g[0],d=g[1],p=0,c=i.length;c>p;p++)if(a=i[p],"number"==typeof a)for(h=a;h>0;){if(f=u(h),null===f)throw Error("The op traverses more elements than the document has");e(l,f),h-=o(f)}else if(void 0!==a.i)e(l,{i:a.i});else for(h=a.d;h>0;){if(f=u(h),null===f)throw Error("The op traverses more elements than the document has");s=o(f),void 0!==f.i?e(l,{i:s}):e(l,{d:s}),h-=s}for(;a=u();){if(void 0===a.i)throw Error("Remaining fragments in op1: "+a);e(l,a)}return l};var l=window.ottypes=window.ottypes||{},u=a.exports;l[u.name]=u,h.uri&&(l[h.uri]=u)})();